#!/usr/bin/env python

import sys

from os.path import (
    abspath,
    dirname,
    join as join_path,
)

sys.path.append(abspath(join_path(dirname(__file__), '../lib')))

from pymud import (
    CONFIG,
    LOGGER,
)

from pymud.network import (
    ClientConnectionManager,
    RequestHandler,
    ThreadingTCPServer,
)

if __name__ == '__main__':
    host = CONFIG.get('general', 'host')
    port = CONFIG.getint('general', 'port')
    server = ThreadingTCPServer(
        (host, port),
        RequestHandler
    )
    try:
        LOGGER.info('Started listening on: "%s:%d"' % (
            host,
            port,
        ))
        server.serve_forever()
    except KeyboardInterrupt:
        LOGGER.info('Stopped listening on: "%s:%d"' % (
            host,
            port,
        ))
    ClientConnectionManager.instance.close_and_remove_all()
